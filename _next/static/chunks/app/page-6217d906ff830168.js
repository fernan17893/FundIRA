(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7245:function(e,t,a){Promise.resolve().then(a.bind(a,6234))},6234:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return $}});var n=a(7437),r=a(2265),s=a(5735),i=a(5236),o=a(9842);let l=(0,i.ZF)({apiKey:"AIzaSyCCEJ01mm5RjyKhhRXyPBjFyyHUKluAeT8",authDomain:"crecipayproj.firebaseapp.com",projectId:"crecipayproj",storageBucket:"crecipayproj.appspot.com",messagingSenderId:"749877361881",appId:"1:749877361881:web:39986415a0f51b2ac212c8"}),c=(0,o.ad)(l);var d=a(1608),u=a(4839),m=a(6164);function f(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,m.m6)((0,u.W)(t))}let h=d.fC,p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(d.aV,{ref:t,className:f("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});p.displayName=d.aV.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(d.xz,{ref:t,className:f("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});x.displayName=d.xz.displayName;let b=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(d.VY,{ref:t,className:f("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});b.displayName=d.VY.displayName,a(3054),a(3025);var g=a(1538);let j=(0,a(2218).j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),v=r.forwardRef((e,t)=>{let{className:a,variant:r,size:s,asChild:i=!1,...o}=e,l=i?g.g7:"button";return(0,n.jsx)(l,{className:f(j({variant:r,size:s,className:a})),ref:t,...o})});function y(){let[e,t]=(0,r.useState)(""),[a,i]=(0,r.useState)(""),o=(0,s.v0)(l),c=async()=>{try{await (0,s.e5)(o,e,a)}catch(e){console.error(e),e instanceof Error?alert("Error: "+e.message):alert("An unknown error occurred.")}},d=async()=>{try{await (0,s.Xb)(o,e,a)}catch(e){console.error(e),e instanceof Error?alert("Error: "+e.message):alert("An unknown error occurred.")}};return(0,n.jsx)("div",{className:"auth-container",children:(0,n.jsxs)(h,{defaultValue:"signIn",className:"TabsRoot",children:[(0,n.jsxs)(p,{className:"TabsList","aria-label":"Manage your account",children:[(0,n.jsx)(x,{className:"TabsTrigger",value:"signIn",children:"Sign In"}),(0,n.jsx)(x,{className:"TabsTrigger",value:"signUp",children:"Sign Up"})]}),(0,n.jsx)(b,{className:"TabsContent",value:"signIn",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Sign In"}),(0,n.jsx)("p",{children:"Sign in to your account"}),(0,n.jsx)("input",{type:"email",value:e,onChange:e=>t(e.target.value),placeholder:"Enter email"}),(0,n.jsx)("input",{type:"password",value:a,onChange:e=>i(e.target.value),placeholder:"Enter password"}),(0,n.jsx)(v,{onClick:c,children:"Sign In"})]})}),(0,n.jsx)(b,{className:"TabsContent",value:"signUp",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Sign Up"}),(0,n.jsx)("p",{children:"Create an account"}),(0,n.jsx)("input",{type:"email",value:e,onChange:e=>t(e.target.value),placeholder:"Enter email"}),(0,n.jsx)("input",{type:"password",value:a,onChange:e=>i(e.target.value),placeholder:"Enter password"}),(0,n.jsx)(v,{onClick:d,children:"Sign Up"})]})})]})})}v.displayName="Button";var N=a(1322),k=a(1505);let w=e=>{let{className:t,...a}=e;return(0,n.jsx)(k.eh,{className:f("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...a})},S=k.s_,C=e=>{let{withHandle:t,className:a,...r}=e;return(0,n.jsx)(k.OT,{className:f("relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",a),...r,children:t&&(0,n.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border",children:(0,n.jsx)(N.Z,{className:"h-2.5 w-2.5"})})})},A=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:t,className:f("w-full caption-bottom text-sm",a),...r})})});A.displayName="Table";let I=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("thead",{ref:t,className:f("[&_tr]:border-b",a),...r})});I.displayName="TableHeader";let T=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("tbody",{ref:t,className:f("[&_tr:last-child]:border-0",a),...r})});T.displayName="TableBody",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("tfoot",{ref:t,className:f("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r})}).displayName="TableFooter";let E=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("tr",{ref:t,className:f("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r})});E.displayName="TableRow";let R=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("th",{ref:t,className:f("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...r})});R.displayName="TableHead";let O=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("td",{ref:t,className:f("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...r})});O.displayName="TableCell";let F=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("caption",{ref:t,className:f("mt-4 text-sm text-muted-foreground",a),...r})});F.displayName="TableCaption",a(3916);var _=a(7857),D=a(4697);let U=_.fC,z=_.xz,B=_.h_;_.x8;let V=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(_.aV,{ref:t,className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});V.displayName=_.aV.displayName;let J=r.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsxs)(B,{children:[(0,n.jsx)(V,{}),(0,n.jsxs)(_.VY,{ref:t,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s,children:[r,(0,n.jsxs)(_.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(D.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});J.displayName=_.VY.displayName;let P=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:f("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};P.displayName="DialogHeader";let q=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(_.Dx,{ref:t,className:f("text-lg font-semibold leading-none tracking-tight",a),...r})});q.displayName=_.Dx.displayName;let L=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(_.dk,{ref:t,className:f("text-sm text-muted-foreground",a),...r})});L.displayName=_.dk.displayName;var H=e=>{let{open:t,setOpen:a,bankAccounts:r,handleSubmit:s}=e;return(0,n.jsx)(U,{open:t,onOpenChange:a,children:(0,n.jsxs)(J,{children:[(0,n.jsxs)(P,{children:[(0,n.jsx)(q,{children:"Add Contribution"}),(0,n.jsx)(L,{children:"Enter your details and the amount you wish to contribute."})]}),(0,n.jsxs)("form",{onSubmit:s,children:[(0,n.jsx)("label",{htmlFor:"email",children:"Email:"}),(0,n.jsx)("input",{type:"email",id:"email",name:"email",required:!0,placeholder:"Enter your email"}),(0,n.jsx)("label",{htmlFor:"bankAccount",children:"Bank Account:"}),(0,n.jsx)("select",{id:"bankAccount",name:"bankAccount",required:!0,children:r.map((e,t)=>(0,n.jsxs)("option",{value:e.bankAccountId,children:[e.bankName," - ****",e.last4]},t))}),(0,n.jsx)("label",{htmlFor:"amount",children:"Amount:"}),(0,n.jsx)("input",{type:"number",id:"amount",name:"amount",required:!0,max:"5000"}),(0,n.jsx)(v,{type:"submit",children:"Submit Contribution"})]})]})})};function Y(){let[e,t]=(0,r.useState)(!1),[a,i]=(0,r.useState)([]),[l,d]=(0,r.useState)([]),u=(0,s.v0)();(0,r.useEffect)(()=>{(async()=>{let e=u.currentUser;if(e){let t=(0,o.IO)((0,o.hJ)(c,"bankAccounts"),(0,o.ar)("userId","==",e.uid));i((await (0,o.PL)(t)).docs.map(e=>({id:e.id,...e.data()})))}})()},[u.currentUser]);let m=(0,r.useCallback)(async()=>{let e=u.currentUser;if(e){let t=(0,o.IO)((0,o.hJ)(c,"contributions"),(0,o.ar)("userId","==",e.uid));d((await (0,o.PL)(t)).docs.map(e=>({id:e.id,...e.data()})))}},[u.currentUser]);(0,r.useEffect)(()=>{m()},[m]);let f=async e=>{e.preventDefault();let a=e.target.elements.namedItem("email"),n=e.target.elements.namedItem("bankAccount"),r=e.target.elements.namedItem("amount"),s={email:a.value,bankAccountId:n.value,amount:r.value};if((await fetch("http://localhost:3001/api/contributions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok){console.log("Contribution processed successfully"),t(!1);let e=u.currentUser;e&&(await (0,o.ET)((0,o.hJ)(c,"contributions"),{userId:e.uid,email:a.value,bankAccountId:n.value,amount:r.value,status:"Completed",date:new Date().toISOString()}),m())}else console.error("Failed to process contribution")};return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("h1",{children:"Contributions"}),(0,n.jsx)(v,{variant:"default",size:"sm",onClick:()=>{t(!0)},children:"Add Contribution"}),(0,n.jsx)(H,{open:e,setOpen:t,bankAccounts:a,handleSubmit:f}),(0,n.jsxs)(A,{className:"table",children:[(0,n.jsx)(F,{children:"Contributions"}),(0,n.jsx)(I,{children:(0,n.jsxs)(E,{children:[(0,n.jsx)(R,{className:"w-[100px]",children:"Invoice"}),(0,n.jsx)(R,{children:"Status"}),(0,n.jsx)(R,{children:"Method"}),(0,n.jsx)(R,{className:"text-right",children:"Amount"})]})}),(0,n.jsx)(T,{children:l.map(e=>(0,n.jsxs)(E,{children:[(0,n.jsx)(O,{children:new Date(e.date).toLocaleDateString()}),(0,n.jsx)(O,{children:e.status}),(0,n.jsx)(O,{children:"Bank Transfer"}),(0,n.jsxs)(O,{className:"text-right",children:["$",e.amount]})]},e.id))})]})]})}var K=a(7345);let M=(0,a(3537).J)("pk_test_51P7zmMRqlaXFAeEODHfjocA2w0TvdX3KBEERGgQ61iCYsvw5R4zYwlcGFUdDadhKqkPmlaMl4bz9rCNkejiwWgLZ00tWcUvEkq");var X=e=>{let{closeDialog:t,userId:a}=e,i=(0,K.useStripe)(),[l,d]=(0,r.useState)(""),[u,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=(0,s.v0)(),t=(0,s.Aj)(e,async e=>{if(e){d(e.email||"");let t=(0,o.JU)(c,"bankAccounts",e.uid),a=await (0,o.QT)(t);a.exists()&&a.data().stripeCustomerId&&m(a.data().stripeCustomerId)}else d("")});return()=>t()},[]);let f=async e=>{if(e.preventDefault(),!i){console.log("Stripe.js hasn't loaded yet.");return}if(!l){console.error("No email found");return}let n=e.target,r=n.bankName.value,s=n.accountNumber.value,d=n.routingNumber.value,f=await i.createToken("bank_account",{country:"US",currency:"usd",routing_number:d,account_number:s,account_holder_name:r,account_holder_type:"individual"});if(f.error)console.error(f.error.message);else{console.log("Bank account token:",f.token.id);try{let e=u;if(!e){let t=await fetch("http://localhost:3001/api/create-customer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l})}),a=await t.json();if(a.success)e=a.customerId,m(e);else{console.error("Error creating Stripe customer:",a.message);return}}let n=await fetch("http://localhost:3001/api/attach-bank-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e,bankAccountToken:f.token.id})}),i=await n.json();if(i.success){let n=i.bankAccount,l=await (0,o.ET)((0,o.hJ)(c,"bankAccounts"),{userId:a,token:f.token.id,bankName:r,routingNumber:d,last4:s.slice(-4),stripeCustomerId:e,bankAccountId:n.id});console.log("Document written with ID: ",l.id),t()}else console.error("Error attaching bank account:",i.message)}catch(e){console.error("Error handling bank account:",e)}}};return(0,n.jsxs)("form",{onSubmit:f,children:[(0,n.jsx)("label",{htmlFor:"bankName",children:"Bank Name"}),(0,n.jsx)("input",{id:"bankName",name:"bankName",required:!0}),(0,n.jsx)("label",{htmlFor:"accountNumber",children:"Account Number"}),(0,n.jsx)("input",{id:"accountNumber",name:"accountNumber",required:!0,type:"number"}),(0,n.jsx)("label",{htmlFor:"routingNumber",children:"Routing Number"}),(0,n.jsx)("input",{id:"routingNumber",name:"routingNumber",required:!0,type:"number"}),(0,n.jsx)(v,{type:"submit",disabled:!i,children:"Submit"})]})},Z=e=>{let{open:t,setOpen:a,verifyBankAccount:i}=e,[l,d]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[f,h]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{let e=(0,s.v0)().currentUser;if(e){let t=(0,o.JU)(c,"bankAccounts",e.uid),a=await (0,o.QT)(t);a.exists()&&h(a.data().BankAccountId)}})()},[]);let p=async e=>{e.preventDefault(),await i([parseInt(l),parseInt(u)]),a(!1)};return(0,n.jsx)(U,{open:t,onOpenChange:a,children:(0,n.jsxs)(J,{children:[(0,n.jsxs)(P,{children:[(0,n.jsx)(q,{children:"Verify Bank Account"}),(0,n.jsx)(L,{children:"Please enter the amounts of the two micro-deposits we sent to your bank account."})]}),(0,n.jsxs)("form",{onSubmit:p,children:[(0,n.jsx)("input",{type:"number",placeholder:"First amount",required:!0,value:l,onChange:e=>d(e.target.value)}),(0,n.jsx)("input",{type:"number",placeholder:"Second amount",required:!0,value:u,onChange:e=>m(e.target.value)}),(0,n.jsx)(v,{type:"submit",children:"Verify"})]})]})})};function Q(){let[e,t]=(0,r.useState)([]),[a,i]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[f,h]=(0,r.useState)(null),p=e=>{console.log("Selected account for verification:",e),h(e),m(!0)},x=async e=>{if(!f){console.error("No account selected for verification");return}console.log("Verifying bank account:",f),(await fetch("http://localhost:3001/api/verify-bank-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:f.stripeCustomerId,bankAccountId:f.bankAccountId,amounts:e})})).ok?console.log("Bank account verified successfully"):console.error("Failed to verify bank account")};return(0,r.useEffect)(()=>{let e=(0,s.v0)(),t=(0,s.Aj)(e,e=>{e?(console.log("User id set:",e.uid),i(e.uid)):i(!1)});return()=>t()},[]),(0,r.useEffect)(()=>{a&&(console.log("Fetching bank accounts for user ID: ",a),(async()=>{let e=(0,o.IO)((0,o.hJ)(c,"bankAccounts"),(0,o.ar)("userId","==",a));t((await (0,o.PL)(e)).docs.map(e=>(console.log("Account data fetched: ",e.data()),e.data())))})())},[a]),(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("h1",{children:"Funding Sources"}),(0,n.jsxs)(U,{open:l,onOpenChange:d,children:[(0,n.jsx)(z,{asChild:!0,children:(0,n.jsx)(v,{variant:"default",size:"sm",children:"Add Fund Source"})}),(0,n.jsxs)(J,{children:[(0,n.jsxs)(P,{children:[(0,n.jsx)(q,{children:"Add ACH Direct Debit Bank Account"}),(0,n.jsx)(L,{children:"Enter your bank account details below."})]}),(0,n.jsx)(K.Elements,{stripe:M,children:"string"==typeof a&&(0,n.jsx)(X,{closeDialog:()=>d(!1),userId:a})})]})]}),(0,n.jsx)(Z,{open:u,setOpen:m,verifyBankAccount:e=>x(e)}),(0,n.jsxs)(A,{className:"table",children:[(0,n.jsx)(F,{children:"Funding Sources"}),(0,n.jsx)(I,{children:(0,n.jsxs)(E,{children:[(0,n.jsx)(R,{children:"Source Name"}),(0,n.jsx)(R,{children:"Account Number"}),(0,n.jsx)(R,{children:"Type"}),(0,n.jsx)(R,{className:"text-right",children:"Balance"})]})}),(0,n.jsx)(T,{children:e.map((e,t)=>(0,n.jsxs)(E,{children:[(0,n.jsx)(O,{children:e.bankName}),(0,n.jsxs)(O,{children:["****",e.last4]}),(0,n.jsx)(O,{children:e.routingNumber}),(0,n.jsx)(O,{children:"$5000"})," ",(0,n.jsx)(O,{children:e.verified?"Verified":(0,n.jsx)(v,{onClick:()=>p(e),children:"Verify"})})]},t))})]})]})}var W=a(3051);function G(){let[e,t]=(0,r.useState)("contributions"),a=(0,s.v0)(l);return(0,n.jsxs)(w,{direction:"horizontal",children:[(0,n.jsx)(S,{className:"left-panel",children:(0,n.jsxs)("div",{className:"menu",children:[(0,n.jsxs)("div",{className:"menu-title",children:[(0,n.jsx)(W.alm,{className:"menu-title-image"})," NextIRA"]}),(0,n.jsxs)(v,{variant:"secondary",onClick:()=>t("contributions"),children:[(0,n.jsx)(W.s0d,{})," Contributions"]}),(0,n.jsxs)(v,{variant:"secondary",onClick:()=>t("fundingSources"),children:[(0,n.jsx)(W.Ao0,{})," Funding Sources"]}),(0,n.jsxs)(v,{variant:"secondary",onClick:()=>{(0,s.w7)(a).catch(e=>console.error("Logout failed",e))},children:[(0,n.jsx)(W.Opj,{})," Logout"]})]})}),(0,n.jsx)(C,{withHandle:!0}),(0,n.jsx)(S,{className:"right-panel",children:(()=>{switch(e){case"contributions":default:return(0,n.jsx)(Y,{});case"fundingSources":return(0,n.jsx)(Q,{})}})()})]})}function $(){let[e,t]=(0,r.useState)(null),a=(0,s.v0)(l);return(0,r.useEffect)(()=>{let e=(0,s.Aj)(a,e=>{t(e)});return()=>e()},[a]),e?(0,n.jsx)(G,{}):(0,n.jsx)(y,{})}},3916:function(){},3054:function(){},3025:function(){}},function(e){e.O(0,[165,522,863,358,258,971,23,744],function(){return e(e.s=7245)}),_N_E=e.O()}]);